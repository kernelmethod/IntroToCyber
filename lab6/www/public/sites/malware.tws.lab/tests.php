<!doctype html>
<html>
<pre>
<?php

class TestCase {
  public string $description;
  public string $message;
  public bool $passed;

  function __construct($description, $message, $passed) {
    $this->description = $description;
    $this->message = $message;
    $this->passed = $passed;
  }

  public static function success($description, $message) {
    return new static($description, $message, true);
  }

  public static function fail($description, $message) {
    return new static($description, $message, false);
  }

  public function print_result() {
    $desc = $this->description;
    echo "TEST CASE: $desc\n";

    if ($this->passed) {
      $result = "PASSED";
    } else {
      $result = "FAILED";
    }

    $msg = $this->message;
    echo "$result: $msg\n";
  }
}

echo "Attempting to read /etc/passwd...\n\n";
readfile("/etc/passwd");

echo "\n\n";

function test_create_tmpfile() {
  $tmpdir = sys_get_temp_dir();
  $desc = "attempting to open a file in $tmpdir";

  $temp = tempnam($tmpdir, "");
  if ( $temp === false ) {
    $msg = "Unable to open file in $tmpdir";
    return TestCase::success($desc, $msg);
  }
  echo "Attempting to write to $temp\n\n";
  $handle = fopen($temp, "w");

  if ( $handle === false ) {
    $msg = "Unable to open $temp for writing";
    return TestCase::success($desc, $msg);
  }

  return TestCase::fail($desc, "Successfully opened $temp for writing");
}

try {
  $result = test_create_tmpfile();
  $result->print_result();
} catch (Exception $e) {
  echo "Caught error: $e\n\n";
}

?>
</pre>
</html>
